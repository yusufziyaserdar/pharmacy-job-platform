@model PharmacyJobPlatform.Web.Models.Admin.AdminDashboardViewModel
@{
    ViewData["Title"] = "Admin Paneli";
}

@section Styles {
    <link rel="stylesheet" href="~/css/admin-panel.css" asp-append-version="true" />
}

<div class="admin-panel">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="admin-title mb-0">Yönetim Paneli</h1>
        <span class="badge text-bg-light px-3 py-2">Sadece Admin</span>
    </div>

    @if (TempData["Success"] is string success)
    {
        <div class="alert alert-success">@success</div>
    }

    @if (TempData["Error"] is string error)
    {
        <div class="alert alert-danger">@error</div>
    }

    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="admin-stat-card">
                <small>Toplam Kullanıcı</small>
                <h3>@Model.TotalUsers</h3>
            </div>
        </div>
        <div class="col-md-3">
            <div class="admin-stat-card">
                <small>Toplam İlan</small>
                <h3>@Model.TotalJobPosts</h3>
            </div>
        </div>
        <div class="col-md-3">
            <div class="admin-stat-card">
                <small>Toplam Yorum</small>
                <h3>@Model.TotalComments</h3>
            </div>
        </div>
        <div class="col-md-3">
            <div class="admin-stat-card">
                <small>Toplam Rapor</small>
                <h3>@Model.TotalReports</h3>
            </div>
        </div>
    </div>

    <ul class="nav nav-tabs admin-tabs" id="adminTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#users" type="button">Kullanıcılar</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#jobs" type="button">İlanlar</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#comments" type="button">Yorumlar</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#reports" type="button">Raporlar</button>
        </li>
    </ul>

    <div class="tab-content admin-content">
        <div class="tab-pane fade show active" id="users" role="tabpanel">
            <div class="table-responsive">
                <table class="table table-dark table-striped align-middle">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ad Soyad</th>
                            <th>Email</th>
                            <th>Rol</th>
                            <th>Kayıt Tarihi</th>
                            <th class="text-end">İşlem</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var user in Model.Users)
                        {
                            <tr>
                                <td>@user.Id</td>
                                <td>@user.FullName</td>
                                <td>@user.Email</td>
                                <td>
                                    @user.RoleName
                                    @if (user.IsDeleted)
                                    {
                                        <span class="badge text-bg-secondary ms-1">Kaldırıldı</span>
                                    }
                                </td>
                                <td>@user.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>
                                <td class="text-end">
                                    <a class="btn btn-sm btn-outline-light" asp-controller="Profile" asp-action="Index" asp-route-id="@user.Id">Profili Aç</a>
                                    @if (user.RoleName != "Admin")
                                    {
                                        if (user.IsDeleted)
                                        {
                                            <form asp-action="RestoreUser" method="post" class="d-inline">
                                                @Html.AntiForgeryToken()
                                                <input type="hidden" name="id" value="@user.Id" />
                                                <button type="submit" class="btn btn-sm btn-outline-success">
                                                    Geri Al
                                                </button>
                                            </form>
                                        }
                                        else
                                        {
                                            <form asp-action="DeleteUser" method="post" class="d-inline">
                                                @Html.AntiForgeryToken()
                                                <input type="hidden" name="id" value="@user.Id" />
                                                <button type="submit" class="btn btn-sm btn-outline-danger"
                                                        onclick="return confirm('Bu kullanıcı profilini kaldırmak istediğinize emin misiniz?')">
                                                    Profili Kaldır
                                                </button>
                                            </form>
                                        }
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-pane fade" id="jobs" role="tabpanel">
            <div class="table-responsive">
                <table class="table table-dark table-striped align-middle">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Başlık</th>
                            <th>İlan Sahibi</th>
                            <th>Durum</th>
                            <th>Tarih</th>
                            <th class="text-end">İşlem</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var post in Model.JobPosts)
                        {
                            <tr>
                                <td>@post.Id</td>
                                <td>@post.Title</td>
                                <td>@post.OwnerName</td>
                                <td>
                                    <span class="badge @(post.IsDeleted ? "text-bg-secondary" : post.IsActive ? "text-bg-success" : "text-bg-warning")">
                                        @(post.IsDeleted ? "Kaldırıldı" : post.IsActive ? "Aktif" : "Pasif")
                                    </span>
                                </td>
                                <td>@post.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>
                                <td class="text-end">
                                    @if (!post.IsDeleted)
                                    {
                                        <form asp-action="ToggleJobPostStatus" method="post" class="d-inline">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="id" value="@post.Id" />
                                            <button type="submit" class="btn btn-sm btn-outline-warning">
                                                @(post.IsActive ? "Pasife Al" : "Aktifleştir")
                                            </button>
                                        </form>
                                        <form asp-action="DeleteJobPost" method="post" class="d-inline">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="id" value="@post.Id" />
                                            <button type="submit" class="btn btn-sm btn-outline-danger"
                                                    onclick="return confirm('Bu ilanı kaldırmak istediğinize emin misiniz?')">
                                                İlanı Kaldır
                                            </button>
                                        </form>
                                    }
                                    else
                                    {
                                        <form asp-action="RestoreJobPost" method="post" class="d-inline">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="id" value="@post.Id" />
                                            <button type="submit" class="btn btn-sm btn-outline-success">
                                                Geri Al
                                            </button>
                                        </form>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-pane fade" id="comments" role="tabpanel">
            <div class="table-responsive">
                <table class="table table-dark table-striped align-middle">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Yazar</th>
                            <th>Yorum</th>
                            <th>Tarih</th>
                            <th class="text-end">İşlem</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var comment in Model.Comments)
                        {
                            <tr>
                                <td>@comment.Id</td>
                                <td>@comment.AuthorName</td>
                                <td class="admin-comment-text">@(comment.IsDeleted ? "[Kaldırılmış yorum]" : comment.Content)</td>
                                <td>@comment.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>
                                <td class="text-end">
                                    <a asp-controller="Profile" asp-action="Index" asp-route-id="@comment.ProfileUserId" class="btn btn-sm btn-outline-light">Profile Git</a>
                                    @if (comment.IsDeleted)
                                    {
                                        <form asp-action="RestoreComment" method="post" class="d-inline">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="id" value="@comment.Id" />
                                            <button type="submit" class="btn btn-sm btn-outline-success">Geri Al</button>
                                        </form>
                                    }
                                    else
                                    {
                                        <form asp-action="DeleteComment" method="post" class="d-inline">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="id" value="@comment.Id" />
                                            <button type="submit" class="btn btn-sm btn-outline-danger"
                                                    onclick="return confirm('Bu yorumu kaldırmak istediğinize emin misiniz?')">
                                                Yorumu Kaldır
                                            </button>
                                        </form>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-pane fade" id="reports" role="tabpanel">
            <h5 class="mt-3">Yeni Gelen Raporlar</h5>
            <div class="table-responsive mb-4">
                <table class="table table-dark table-striped align-middle">
                    <thead><tr><th>#</th><th>Tür</th><th>İçerik ID</th><th>Raporlayan</th><th>Neden</th><th>Raporlanan İçerik</th><th>Tarih</th><th class="text-end">İşlem</th></tr></thead>
                    <tbody>
                    @foreach (var report in Model.PendingReports)
                    {
                        <tr>
                            <td>@report.Id</td>
                            <td>@report.EntityType</td>
                            <td>@report.EntityId</td>
                            <td>@report.ReporterName</td>
                            <td>@report.Reason</td>
                            <td>@report.ReportedContent</td>
                            <td>@report.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>
                            <td class="text-end">
                                <form asp-action="ResolveReportRemove" method="post" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="reportId" value="@report.Id" />
                                    <button type="submit" class="btn btn-sm btn-outline-warning">Sadece Kaldır</button>
                                </form>
                                <form asp-action="ResolveReportRemoveWithWarning" method="post" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="reportId" value="@report.Id" />
                                    <button type="submit" class="btn btn-sm btn-outline-danger">Kaldır + Uyarı Gönder</button>
                                </form>
                                @if (!string.IsNullOrEmpty(report.ContentLinkController) && !string.IsNullOrEmpty(report.ContentLinkAction) && report.ContentLinkId.HasValue)
                                {
                                    <a asp-controller="@report.ContentLinkController"
                                       asp-action="@report.ContentLinkAction"
                                       asp-route-id="@report.ContentLinkId.Value"
                                       class="btn btn-sm btn-outline-info">
                                        İçeriğe Git
                                    </a>
                                }
                                <form asp-action="ResolveReportKeep" method="post" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="reportId" value="@report.Id" />
                                    <button type="submit" class="btn btn-sm btn-outline-success">İçeriği Bırak</button>
                                </form>
                            </td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>

            <h5>İşlem Yapılmış Raporlar</h5>
            <div class="table-responsive">
                <table class="table table-dark table-striped align-middle">
                    <thead><tr><th>#</th><th>Tür</th><th>İçerik ID</th><th>Raporlayan</th><th>Neden</th><th>Raporlanan İçerik</th><th>Durum</th><th>İnceleyen</th><th>İnceleme Tarihi</th><th>Link</th></tr></thead>
                    <tbody>
                    @foreach (var report in Model.ReviewedReports)
                    {
                        <tr>
                            <td>@report.Id</td>
                            <td>@report.EntityType</td>
                            <td>@report.EntityId</td>
                            <td>@report.ReporterName</td>
                            <td>@report.Reason</td>
                            <td>@report.ReportedContent</td>
                            <td>@(report.Status == PharmacyJobPlatform.Domain.Enums.ReportStatus.ResolvedRemoved ? "İçerik Kaldırıldı" : "İçerik Bırakıldı")</td>
                            <td>@report.ReviewedByAdminName</td>
                            <td>@report.ReviewedAt?.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>
                            <td>
                                @if (!string.IsNullOrEmpty(report.ContentLinkController) && !string.IsNullOrEmpty(report.ContentLinkAction) && report.ContentLinkId.HasValue)
                                {
                                    <a asp-controller="@report.ContentLinkController"
                                       asp-action="@report.ContentLinkAction"
                                       asp-route-id="@report.ContentLinkId.Value"
                                       class="btn btn-sm btn-outline-info">
                                        İçeriğe Git
                                    </a>
                                }
                            </td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
